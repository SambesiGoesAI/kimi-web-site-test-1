import{r as n,j as e}from"./index-D5aIP0Ub.js";function f(s){const i=new Date;return s.find(t=>{const r=new Date(t.startDate),c=new Date(t.endDate);return i>=r&&i<c})??null}function k(s,i){const t=new Date;return s.filter(r=>new Date(r.startDate)>=t).sort((r,c)=>new Date(r.startDate).getTime()-new Date(c.startDate).getTime()).slice(0,i)}function u(s){return new Date(s).toLocaleTimeString("fi-FI",{hour:"2-digit",minute:"2-digit"})}function j(s){return s<=0?"text-green-400":s<5?"text-green-300":s<10?"text-yellow-300":s<15?"text-orange-400":"text-red-400"}function v(s){return s<=0?"bg-green-400":s<5?"bg-green-300":s<10?"bg-yellow-300":s<15?"bg-orange-400":"bg-red-400"}function w(){const[s,i]=n.useState(null),[t,r]=n.useState(!1),[c,o]=n.useState(null),[d,b]=n.useState(null),l=n.useCallback(async()=>{r(!0),o(null);try{const a=await fetch("https://api.porssisahko.net/v1/latest-prices.json");if(!a.ok)throw new Error(`HTTP ${a.status}`);const x=await a.json();i(x),b(new Date)}catch(a){o(a instanceof Error?a.message:"Failed to fetch prices")}finally{r(!1)}},[]);n.useEffect(()=>{l()},[l]);const p=s?f(s.prices):null,h=s?k(s.prices,12):[],g=h.length>0?Math.max(...h.map(a=>Math.max(a.price,1))):1;return e.jsxs("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:84:5",className:"hub-widget animate-fade-in",children:[e.jsxs("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:85:7",className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:86:9",className:"flex items-center gap-3",children:[e.jsx("span",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:87:11",className:"text-2xl",children:"⚡"}),e.jsx("h2",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:88:11",className:"text-lg font-semibold text-white",children:"Porssisahko"})]}),e.jsxs("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:90:9",className:"flex items-center gap-3",children:[d&&e.jsx("span",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:92:13",className:"text-xs text-zinc-500",children:d.toLocaleTimeString("fi-FI")}),e.jsx("button",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:96:11",onClick:l,disabled:t,className:"text-xs text-zinc-400 hover:text-white transition-colors px-2 py-1 rounded border border-zinc-700 hover:border-zinc-500 disabled:opacity-50",children:t?"...":"Refresh"})]})]}),c&&e.jsx("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:107:9",className:"text-red-400 text-sm mb-4 p-3 rounded-lg bg-red-950/30 border border-red-900/50",children:c}),p&&e.jsxs("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:113:9",className:"text-center mb-8",children:[e.jsx("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:114:11",className:"text-xs uppercase tracking-widest text-zinc-500 mb-2",children:"Current price"}),e.jsx("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:117:11",className:`text-6xl font-bold tracking-tight ${j(p.price)}`,children:p.price.toFixed(2)}),e.jsx("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:120:11",className:"text-sm text-zinc-500 mt-1",children:"snt/kWh"}),e.jsxs("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:121:11",className:"text-xs text-zinc-600 mt-2",children:[u(p.startDate)," – ",u(p.endDate)]})]}),!p&&!t&&!c&&e.jsx("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:128:9",className:"text-center mb-8 text-zinc-500",children:"No current price available"}),t&&!s&&e.jsx("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:134:9",className:"text-center mb-8",children:e.jsx("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:135:11",className:"text-zinc-500 animate-pulse",children:"Loading prices..."})}),h.length>0&&e.jsxs("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:140:9",children:[e.jsx("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:141:11",className:"text-xs uppercase tracking-widest text-zinc-500 mb-3",children:"Upcoming hours"}),e.jsx("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:144:11",className:"flex items-end gap-1 h-32",children:h.map((a,x)=>{const m=Math.max(a.price/g*100,4);return e.jsxs("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:148:17",className:"flex-1 flex flex-col items-center gap-1 group",children:[e.jsx("span",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:149:19",className:"text-[10px] text-zinc-500 opacity-0 group-hover:opacity-100 transition-opacity",children:a.price.toFixed(1)}),e.jsx("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:152:19",className:`w-full rounded-sm ${v(a.price)} transition-all group-hover:opacity-80`,style:{height:`${m}%`}}),e.jsx("span",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:156:19",className:"text-[10px] text-zinc-600",children:u(a.startDate)})]},x)})})]})]})}const N={e:"electricity",Escape:"none"};function W(){const[s,i]=n.useState("none"),t=n.useCallback(r=>{const c=r.target.tagName;if(c==="INPUT"||c==="TEXTAREA"||c==="SELECT")return;const o=N[r.key];o!==void 0&&i(d=>d===o?"none":o)},[]);return n.useEffect(()=>(window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)),[t]),e.jsxs("div",{"code-path":"src/apps/hub/HubApp.tsx:32:5",className:"hub-root",children:[s==="none"&&e.jsxs("div",{"code-path":"src/apps/hub/HubApp.tsx:35:9",className:"hub-idle animate-fade-in",children:[e.jsx("h1",{"code-path":"src/apps/hub/HubApp.tsx:36:11",className:"hub-title",children:"Hub"}),e.jsx("div",{"code-path":"src/apps/hub/HubApp.tsx:37:11",className:"hub-keys",children:e.jsx(P,{"code-path":"src/apps/hub/HubApp.tsx:38:13",keyChar:"E",label:"Electricity price"})}),e.jsx("div",{"code-path":"src/apps/hub/HubApp.tsx:40:11",className:"hub-hint",children:"Press a key to get started"})]}),s==="electricity"&&e.jsxs("div",{"code-path":"src/apps/hub/HubApp.tsx:46:9",className:"hub-widget-container animate-fade-in",children:[e.jsx(w,{"code-path":"src/apps/hub/HubApp.tsx:47:11"}),e.jsxs("div",{"code-path":"src/apps/hub/HubApp.tsx:48:11",className:"hub-back-hint",children:["Press ",e.jsx("kbd",{"code-path":"src/apps/hub/HubApp.tsx:49:19",children:"E"})," or ",e.jsx("kbd",{"code-path":"src/apps/hub/HubApp.tsx:49:35",children:"Esc"})," to close"]})]})]})}function P({keyChar:s,label:i}){return e.jsxs("button",{"code-path":"src/apps/hub/HubApp.tsx:59:5",className:"hub-key-hint",onClick:()=>window.dispatchEvent(new KeyboardEvent("keydown",{key:s.toLowerCase()})),children:[e.jsx("kbd",{"code-path":"src/apps/hub/HubApp.tsx:63:7",className:"hub-kbd",children:s}),e.jsx("span",{"code-path":"src/apps/hub/HubApp.tsx:64:7",className:"hub-key-label",children:i})]})}export{W as default};
