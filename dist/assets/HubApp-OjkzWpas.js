import{r as n,j as e}from"./index-Dg_ACdi3.js";function b(s){return s*100}function w(s){const c=new Date;for(const t of s){const a=new Date(t.DateTime),i=new Date(a.getTime()+900*1e3);if(c>=a&&c<i)return t}return null}function P(s,c){const t=new Date;return s.filter(a=>new Date(a.DateTime)>=t).sort((a,i)=>new Date(a.DateTime).getTime()-new Date(i.DateTime).getTime()).slice(0,c)}function m(s){return new Date(s).toLocaleTimeString("fi-FI",{hour:"2-digit",minute:"2-digit"})}function v(s){return s<=0?"text-green-400":s<5?"text-green-300":s<10?"text-yellow-300":s<15?"text-orange-400":"text-red-400"}function N(s){return s<=0?"bg-green-400":s<5?"bg-green-300":s<10?"bg-yellow-300":s<15?"bg-orange-400":"bg-red-400"}function W(){const[s,c]=n.useState([]),[t,a]=n.useState(!1),[i,o]=n.useState(null),[h,f]=n.useState(null),x=n.useCallback(async()=>{a(!0),o(null);try{const r=await fetch("https://api.spot-hinta.fi/TodayAndDayForward");if(!r.ok)throw new Error(`HTTP ${r.status}`);const l=await r.json();c(l),f(new Date)}catch(r){o(r instanceof Error?r.message:"Failed to fetch prices")}finally{a(!1)}},[]);n.useEffect(()=>{x()},[x]);const p=s.length>0?w(s):null,d=s.length>0?P(s,24):[],k=d.length>0?Math.max(...d.map(r=>Math.max(b(r.PriceWithTax),1))):1,g=p?b(p.PriceWithTax):0;return e.jsxs("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:92:5",className:"hub-widget animate-fade-in",children:[e.jsxs("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:93:7",className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:94:9",className:"flex items-center gap-3",children:[e.jsx("span",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:95:11",className:"text-2xl",children:"⚡"}),e.jsx("h2",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:96:11",className:"text-lg font-semibold text-white",children:"Pörssisähkö"})]}),e.jsxs("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:98:9",className:"flex items-center gap-3",children:[h&&e.jsx("span",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:100:13",className:"text-xs text-zinc-500",children:h.toLocaleTimeString("fi-FI")}),e.jsx("button",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:104:11",onClick:x,disabled:t,className:"text-xs text-zinc-400 hover:text-white transition-colors px-2 py-1 rounded border border-zinc-700 hover:border-zinc-500 disabled:opacity-50",children:t?"...":"Refresh"})]})]}),i&&e.jsx("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:115:9",className:"text-red-400 text-sm mb-4 p-3 rounded-lg bg-red-950/30 border border-red-900/50",children:i}),p&&e.jsxs("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:121:9",className:"text-center mb-8",children:[e.jsx("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:122:11",className:"text-xs uppercase tracking-widest text-zinc-500 mb-2",children:"Hinta nyt"}),e.jsx("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:125:11",className:`text-6xl font-bold tracking-tight ${v(g)}`,children:g.toFixed(2)}),e.jsx("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:128:11",className:"text-sm text-zinc-500 mt-1",children:"snt/kWh (sis. ALV)"}),e.jsxs("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:129:11",className:"text-xs text-zinc-600 mt-2",children:[m(p.DateTime)," – ",m(new Date(new Date(p.DateTime).getTime()+900*1e3).toISOString())]})]}),!p&&!t&&!i&&e.jsx("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:136:9",className:"text-center mb-8 text-zinc-500",children:"No current price available"}),t&&s.length===0&&e.jsx("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:142:9",className:"text-center mb-8",children:e.jsx("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:143:11",className:"text-zinc-500 animate-pulse",children:"Loading prices..."})}),d.length>0&&e.jsxs("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:148:9",children:[e.jsx("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:149:11",className:"text-xs uppercase tracking-widest text-zinc-500 mb-3",children:"Tulevat tunnit"}),e.jsx("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:152:11",className:"flex items-end gap-[2px] h-32",children:d.map((r,l)=>{const u=b(r.PriceWithTax),j=Math.max(u/k*100,4);return e.jsxs("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:157:17",className:"flex-1 flex flex-col items-center gap-1 group",children:[e.jsx("span",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:158:19",className:"text-[10px] text-zinc-500 opacity-0 group-hover:opacity-100 transition-opacity",children:u.toFixed(1)}),e.jsx("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:161:19",className:`w-full rounded-sm ${N(u)} transition-all group-hover:opacity-80`,style:{height:`${j}%`}}),e.jsx("span",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:165:19",className:"text-[10px] text-zinc-600",children:l%4===0?m(r.DateTime):""})]},l)})}),e.jsx("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:172:11",className:"text-right mt-2",children:e.jsx("span",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:173:13",className:"text-[10px] text-zinc-600",children:"spot-hinta.fi"})})]})]})}const y={e:"electricity",Escape:"none"};function E(){const[s,c]=n.useState("none"),t=n.useCallback(a=>{const i=a.target.tagName;if(i==="INPUT"||i==="TEXTAREA"||i==="SELECT")return;const o=y[a.key];o!==void 0&&c(h=>h===o?"none":o)},[]);return n.useEffect(()=>(window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)),[t]),e.jsxs("div",{"code-path":"src/apps/hub/HubApp.tsx:32:5",className:"hub-root",children:[s==="none"&&e.jsxs("div",{"code-path":"src/apps/hub/HubApp.tsx:35:9",className:"hub-idle animate-fade-in",children:[e.jsx("h1",{"code-path":"src/apps/hub/HubApp.tsx:36:11",className:"hub-title",children:"Hub"}),e.jsx("div",{"code-path":"src/apps/hub/HubApp.tsx:37:11",className:"hub-keys",children:e.jsx(T,{"code-path":"src/apps/hub/HubApp.tsx:38:13",keyChar:"E",label:"Electricity price"})}),e.jsx("div",{"code-path":"src/apps/hub/HubApp.tsx:40:11",className:"hub-hint",children:"Press a key to get started"})]}),s==="electricity"&&e.jsxs("div",{"code-path":"src/apps/hub/HubApp.tsx:46:9",className:"hub-widget-container animate-fade-in",children:[e.jsx(W,{"code-path":"src/apps/hub/HubApp.tsx:47:11"}),e.jsxs("div",{"code-path":"src/apps/hub/HubApp.tsx:48:11",className:"hub-back-hint",children:["Press ",e.jsx("kbd",{"code-path":"src/apps/hub/HubApp.tsx:49:19",children:"E"})," or ",e.jsx("kbd",{"code-path":"src/apps/hub/HubApp.tsx:49:35",children:"Esc"})," to close"]})]})]})}function T({keyChar:s,label:c}){return e.jsxs("button",{"code-path":"src/apps/hub/HubApp.tsx:59:5",className:"hub-key-hint",onClick:()=>window.dispatchEvent(new KeyboardEvent("keydown",{key:s.toLowerCase()})),children:[e.jsx("kbd",{"code-path":"src/apps/hub/HubApp.tsx:63:7",className:"hub-kbd",children:s}),e.jsx("span",{"code-path":"src/apps/hub/HubApp.tsx:64:7",className:"hub-key-label",children:c})]})}export{E as default};
