import{r as o,j as e}from"./index-BvD_Lmof.js";function b(s){return s*100}function W(s){const a=new Date;for(const t of s){const i=new Date(t.DateTime),c=new Date(i.getTime()+900*1e3);if(a>=i&&a<c)return t}return null}function w(s,a){const t=new Date;return s.filter(i=>new Date(i.DateTime)>=t).sort((i,c)=>new Date(i.DateTime).getTime()-new Date(c.DateTime).getTime()).slice(0,a)}function T(s){if(s.length<4)return null;let a=1/0,t=0;for(let r=0;r<=s.length-4;r++){const d=(s[r].PriceWithTax+s[r+1].PriceWithTax+s[r+2].PriceWithTax+s[r+3].PriceWithTax)/4;d<a&&(a=d,t=r)}const i=s[t].DateTime,c=new Date(new Date(s[t+3].DateTime).getTime()+900*1e3).toISOString();return{startIndex:t,avgCents:b(a),startTime:i,endTime:c}}function u(s){return new Date(s).toLocaleTimeString("fi-FI",{hour:"2-digit",minute:"2-digit"})}function k(s){return s<=0?"text-green-400":s<5?"text-green-300":s<10?"text-yellow-300":s<15?"text-orange-400":"text-red-400"}function y(s){return s<=0?"bg-green-400":s<5?"bg-green-300":s<10?"bg-yellow-300":s<15?"bg-orange-400":"bg-red-400"}function D(){const[s,a]=o.useState([]),[t,i]=o.useState(!1),[c,r]=o.useState(null),[d,j]=o.useState(null),g=o.useCallback(async()=>{i(!0),r(null);try{const n=await fetch("https://api.spot-hinta.fi/TodayAndDayForward");if(!n.ok)throw new Error(`HTTP ${n.status}`);const l=await n.json();a(l),j(new Date)}catch(n){r(n instanceof Error?n.message:"Failed to fetch prices")}finally{i(!1)}},[]);o.useEffect(()=>{g()},[g]);const p=s.length>0?W(s):null,x=s.length>0?w(s,24):[],P=x.length>0?Math.max(...x.map(n=>Math.max(b(n.PriceWithTax),1))):1,f=p?b(p.PriceWithTax):0,h=x.length>=4?T(x):null;return e.jsxs("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:123:5",className:"hub-widget animate-fade-in",children:[e.jsxs("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:124:7",className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:125:9",className:"flex items-center gap-3",children:[e.jsx("span",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:126:11",className:"text-2xl",children:"⚡"}),e.jsx("h2",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:127:11",className:"text-lg font-semibold text-white",children:"Pörssisähkö"})]}),e.jsxs("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:129:9",className:"flex items-center gap-3",children:[d&&e.jsx("span",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:131:13",className:"text-xs text-zinc-500",children:d.toLocaleTimeString("fi-FI")}),e.jsx("button",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:135:11",onClick:g,disabled:t,className:"text-xs text-zinc-400 hover:text-white transition-colors px-2 py-1 rounded border border-zinc-700 hover:border-zinc-500 disabled:opacity-50",children:t?"...":"Refresh"})]})]}),c&&e.jsx("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:146:9",className:"text-red-400 text-sm mb-4 p-3 rounded-lg bg-red-950/30 border border-red-900/50",children:c}),p&&e.jsxs("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:152:9",className:"text-center mb-8",children:[e.jsx("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:153:11",className:"text-xs uppercase tracking-widest text-zinc-500 mb-2",children:"Hinta nyt"}),e.jsx("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:156:11",className:`text-6xl font-bold tracking-tight ${k(f)}`,children:f.toFixed(2)}),e.jsx("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:159:11",className:"text-sm text-zinc-500 mt-1",children:"snt/kWh (sis. ALV)"}),e.jsxs("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:160:11",className:"text-xs text-zinc-600 mt-2",children:[u(p.DateTime)," – ",u(new Date(new Date(p.DateTime).getTime()+900*1e3).toISOString())]})]}),h&&e.jsxs("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:167:9",className:"mb-6 p-4 rounded-xl bg-green-950/30 border border-green-900/40",children:[e.jsxs("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:168:11",className:"flex items-center gap-2 mb-1",children:[e.jsx("span",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:169:13",className:"text-green-400 text-sm",children:"▼"}),e.jsx("span",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:170:13",className:"text-xs uppercase tracking-widest text-green-400/70",children:"Halvin tunti"})]}),e.jsxs("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:174:11",className:"flex items-baseline gap-3",children:[e.jsx("span",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:175:13",className:`text-2xl font-bold ${k(h.avgCents)}`,children:h.avgCents.toFixed(2)}),e.jsx("span",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:178:13",className:"text-xs text-zinc-500",children:"snt/kWh (ka.)"})]}),e.jsxs("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:180:11",className:"text-sm text-zinc-400 mt-1",children:[u(h.startTime)," – ",u(h.endTime)]})]}),!p&&!t&&!c&&e.jsx("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:187:9",className:"text-center mb-8 text-zinc-500",children:"No current price available"}),t&&s.length===0&&e.jsx("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:193:9",className:"text-center mb-8",children:e.jsx("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:194:11",className:"text-zinc-500 animate-pulse",children:"Loading prices..."})}),x.length>0&&e.jsxs("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:199:9",children:[e.jsx("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:200:11",className:"text-xs uppercase tracking-widest text-zinc-500 mb-3",children:"Tulevat tunnit"}),e.jsx("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:203:11",className:"flex items-end gap-[2px] h-32",children:x.map((n,l)=>{const m=b(n.PriceWithTax),v=Math.max(m/P*100,4),N=h!=null&&l>=h.startIndex&&l<h.startIndex+4;return e.jsxs("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:212:17",className:"flex-1 flex flex-col items-center gap-1 group relative",children:[e.jsx("span",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:213:19",className:"text-[10px] text-zinc-500 opacity-0 group-hover:opacity-100 transition-opacity",children:m.toFixed(1)}),e.jsx("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:216:19",className:`w-full rounded-sm transition-all group-hover:opacity-80 ${N?"bg-green-400 ring-1 ring-green-400/50":y(m)}`,style:{height:`${v}%`}}),e.jsx("span",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:224:19",className:"text-[10px] text-zinc-600",children:l%4===0?u(n.DateTime):""})]},l)})}),e.jsx("div",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:231:11",className:"text-right mt-2",children:e.jsx("span",{"code-path":"src/apps/hub/PorssisahkoWidget.tsx:232:13",className:"text-[10px] text-zinc-600",children:"spot-hinta.fi"})})]})]})}const A={e:"electricity",Escape:"none"};function C(){const[s,a]=o.useState("none"),t=o.useCallback(i=>{const c=i.target.tagName;if(c==="INPUT"||c==="TEXTAREA"||c==="SELECT")return;const r=A[i.key];r!==void 0&&a(d=>d===r?"none":r)},[]);return o.useEffect(()=>(window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)),[t]),e.jsxs("div",{"code-path":"src/apps/hub/HubApp.tsx:32:5",className:"hub-root",children:[s==="none"&&e.jsxs("div",{"code-path":"src/apps/hub/HubApp.tsx:35:9",className:"hub-idle animate-fade-in",children:[e.jsx("h1",{"code-path":"src/apps/hub/HubApp.tsx:36:11",className:"hub-title",children:"Hub"}),e.jsx("div",{"code-path":"src/apps/hub/HubApp.tsx:37:11",className:"hub-keys",children:e.jsx(H,{"code-path":"src/apps/hub/HubApp.tsx:38:13",keyChar:"E",label:"Electricity price"})}),e.jsx("div",{"code-path":"src/apps/hub/HubApp.tsx:40:11",className:"hub-hint",children:"Press a key to get started"})]}),s==="electricity"&&e.jsxs("div",{"code-path":"src/apps/hub/HubApp.tsx:46:9",className:"hub-widget-container animate-fade-in",children:[e.jsx(D,{"code-path":"src/apps/hub/HubApp.tsx:47:11"}),e.jsxs("div",{"code-path":"src/apps/hub/HubApp.tsx:48:11",className:"hub-back-hint",children:["Press ",e.jsx("kbd",{"code-path":"src/apps/hub/HubApp.tsx:49:19",children:"E"})," or ",e.jsx("kbd",{"code-path":"src/apps/hub/HubApp.tsx:49:35",children:"Esc"})," to close"]})]})]})}function H({keyChar:s,label:a}){return e.jsxs("button",{"code-path":"src/apps/hub/HubApp.tsx:59:5",className:"hub-key-hint",onClick:()=>window.dispatchEvent(new KeyboardEvent("keydown",{key:s.toLowerCase()})),children:[e.jsx("kbd",{"code-path":"src/apps/hub/HubApp.tsx:63:7",className:"hub-kbd",children:s}),e.jsx("span",{"code-path":"src/apps/hub/HubApp.tsx:64:7",className:"hub-key-label",children:a})]})}export{C as default};
